<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>清单Plus</title>
<meta name="theme-color" content="#0f1221" />
<style>
  :root{
    --bg:#0f1221; --panel:#14182b; --panel-2:#101426; --text:#e9ecf5; --muted:#9aa3b2;
    --brand:#7c8cff; --accent:#95e1ff; --chip:#1b2140; --ok:#40d589; --danger:#ff6b6b;
    --shadow:0 10px 25px rgba(0,0,0,.35); --radius:16px;
  }
  :root.light{
    --bg:#f6f7fb; --panel:#fff; --panel-2:#fff; --text:#111423; --muted:#606a78;
    --brand:#5b6cff; --accent:#007aff; --chip:#eef1ff; --ok:#10b981; --danger:#ef4444;
    --shadow:0 10px 25px rgba(0,0,0,.08);
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);
    font:500 16px/1.45 ui-sans-serif,system-ui,-apple-system,"SF Pro Text","Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Noto Sans CJK SC","Microsoft YaHei",sans-serif;}
  .wrap{max-width:980px;margin:0 auto;padding:18px 14px 26px}

  .top{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;margin:6px 0 14px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo-dot{width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,#7c8cff 0%,#a677ff 100%);box-shadow:var(--shadow)}
  .brand h1{margin:0;font-size:20px;letter-spacing:.5px}
  .meta{text-align:right;display:flex;flex-direction:column;gap:2px;align-items:flex-end}
  .meta .date{font-weight:700;font-size:13px;color:var(--muted)}
  .meta .time{font-weight:800;font-size:22px}
  .toggle{margin-top:4px;display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:var(--panel);box-shadow:var(--shadow);color:var(--muted);cursor:pointer;user-select:none}

  .panel{background:var(--panel);border-radius:var(--radius);box-shadow:var(--shadow)}
  .filters{padding:12px}
  .filter-item{display:flex;justify-content:space-between;align-items:center;padding:14px 12px;border-radius:12px;margin:6px 0;background:var(--panel-2);cursor:pointer}
  .filter-item b{font-weight:700}
  .badge{min-width:28px;text-align:center;padding:3px 8px;border-radius:999px;background:var(--chip);color:var(--muted)}

  .list{margin-top:14px}
  .item{display:flex;align-items:center;gap:10px;padding:14px;border-radius:14px;background:var(--panel);box-shadow:var(--shadow);margin:10px 0}
  .item input[type="checkbox"]{width:22px;height:22px;accent-color:var(--ok)}
  .title{flex:1;font-weight:700}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:var(--chip);color:var(--muted);font-size:13px}
  .chip svg{width:15px;height:15px;opacity:.9}
  .danger{color:#fff;background:linear-gradient(135deg,#ff7a7a,#ff4d4d)}
  .btn{border:0;border-radius:12px;padding:10px 14px;background:var(--brand);color:#fff;font-weight:700;cursor:pointer}

  .composer{margin-top:16px;padding:14px;border-radius:var(--radius);background:var(--panel);box-shadow:var(--shadow)}
  .row{display:flex;gap:10px;align-items:center}
  .input{flex:1;min-height:52px;padding:12px 14px;border:2px solid transparent;outline:0;border-radius:12px;background:var(--panel-2);color:var(--text);font-size:17px}
  .input:focus{border-color:var(--brand)}
  .pickers{display:flex;gap:10px}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:999px;background:var(--chip);color:var(--text);cursor:pointer;user-select:none}
  .pill svg{width:18px;height:18px}
  .add-btn{display:inline-flex;align-items:center;gap:8px;background:var(--ok);white-space:nowrap}
  .add-btn svg{width:18px;height:18px}
  .hint{margin-top:10px;color:var(--muted);font-size:13px}

  /* modal date-time sheet */
  .sheet{position:fixed;inset:0;display:none;place-items:end center;background:rgba(0,0,0,.45);z-index:50}
  .sheet.show{display:grid}
  .sheet-card{width:100%;max-width:560px;background:var(--panel);color:var(--text);border-top-left-radius:16px;border-top-right-radius:16px;box-shadow:var(--shadow);padding:16px 14px 12px}
  .sheet-head{display:flex;justify-content:space-between;align-items:center;margin-bottom:12px}
  .sheet-title{font-weight:800}
  .sheet-body{display:grid;grid-template-columns:1fr 1fr;gap:12px}
  .sheet-body input{width:100%;border:2px solid transparent;background:var(--panel-2);color:var(--text);padding:12px;border-radius:12px;font-size:16px}
  .sheet-foot{display:flex;gap:10px;justify-content:flex-end;margin-top:12px}
  .ghost{background:var(--chip);color:var(--text)}
  footer{margin:24px 0 8px;text-align:center;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div class="brand">
      <div class="logo-dot"></div><h1>清单Plus</h1>
    </div>
    <div class="meta">
      <div class="date" id="todayStr">2025-09-06</div>
      <div class="time" id="nowStr">4:50 PM</div>
      <div class="toggle" id="modeToggle"><span id="modeIcon">🌙</span><span id="modeText">深色</span></div>
    </div>
  </div>

  <div class="panel filters">
    <div class="filter-item" data-filter="all"><span>全部</span><span class="badge" id="count-all">0</span></div>
    <div class="filter-item" data-filter="today"><span>今天</span><span class="badge" id="count-today">0</span></div>
    <div class="filter-item" data-filter="important"><span><b>重要</b></span><span class="badge" id="count-important">0</span></div>
    <div class="filter-item" data-filter="done"><span>已完成</span><span class="badge" id="count-done">0</span></div>
    <div class="filter-item" data-filter="todo"><span>未完成</span><span class="badge" id="count-todo">0</span></div>
  </div>

  <div id="list" class="list"></div>

  <div class="composer">
    <div class="row">
      <input id="taskInput" class="input" placeholder="输入任务…" autocomplete="off" />
      <div class="pickers">
        <div class="pill" id="datePill" role="button" aria-label="选择日期">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h1V3a1 1 0 0 1 1-1Zm13 9H4v9a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-9ZM5 7a1 1 0 0 0-1 1v1h16V8a1 1 0 0 0-1-1H5Z"/></svg>
          <span id="dateLabel">今天</span>
        </div>
        <div class="pill" id="timePill" role="button" aria-label="选择时间">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 1 1 0 20 10 10 0 0 1 0-20Zm0 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm1 3v5.17l3.59 3.58-1.42 1.42L11 12.59V7h2Z"/></svg>
          <span id="timeLabel">无时间</span>
        </div>
      </div>
      <button class="btn add-btn" id="tapEnter" title="添加">
        <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19 11H7.83l4.58-4.59L11 5l-7 7 7 7 1.41-1.41L7.83 13H19z"/></svg>
        Enter
      </button>
    </div>
    <div class="hint">提示：按 <b>Enter</b> 或点击右侧 <b>Enter</b> 按钮可添加；点「📅 ⏰」设置日期与时间</div>
  </div>

  <footer>© 2025 清单Plus · 本地保存 · 轻快 · 极简</footer>
</div>

<!-- Date/Time Sheet -->
<div class="sheet" id="dtSheet" aria-hidden="true">
  <div class="sheet-card" role="dialog" aria-modal="true" aria-labelledby="dtTitle">
    <div class="sheet-head">
      <div class="sheet-title" id="dtTitle">选择日期与时间</div>
      <button class="btn ghost" id="dtCancel">取消</button>
    </div>
    <div class="sheet-body">
      <input id="dateInput" type="date" />
      <input id="timeInput" type="time" />
    </div>
    <div class="sheet-foot">
      <button class="btn ghost" id="dtClear">清空</button>
      <button class="btn" id="dtSave">保存</button>
    </div>
  </div>
</div>

<script>
/* ---------- utils ---------- */
const $ = s=>document.querySelector(s);
const listEl = $('#list');
const taskInput = $('#taskInput');
const tapEnter = $('#tapEnter');

const todayStrEl = $('#todayStr');
const nowStrEl   = $('#nowStr');

const datePill = $('#datePill'), timePill = $('#timePill');
const dateLabel = $('#dateLabel'), timeLabel = $('#timeLabel');

const sheet = $('#dtSheet'), dtCancel = $('#dtCancel'), dtSave = $('#dtSave'), dtClear=$('#dtClear');
const dateInput = $('#dateInput'), timeInput = $('#timeInput');

const counts = {
  all: $('#count-all'), today: $('#count-today'), important: $('#count-important'),
  done: $('#count-done'), todo: $('#count-todo')
};
let filter='all';
let tasks = JSON.parse(localStorage.getItem('qingdan_tasks_v4')||'[]');

function pad(n){return n<10?'0'+n:n}
function format12(hm){ // "HH:MM" -> "h:MM AM/PM"
  if(!hm) return '';
  const [H,M]=hm.split(':').map(x=>parseInt(x,10));
  let h=H%12; if(h===0) h=12;
  return `${h}:${pad(M)} ${H>=12?'PM':'AM'}`;
}
function isoDate(d){return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`}
function prettyDate(iso){
  const d=new Date(iso+'T00:00:00'); return d.toLocaleDateString(undefined,{month:'short',day:'numeric',year:'numeric'})
}
function tick(){
  const now=new Date();
  todayStrEl.textContent=isoDate(now);
  let h=now.getHours(), m=pad(now.getMinutes()); const ap=h>=12?'PM':'AM'; h=h%12; if(h===0)h=12;
  nowStrEl.textContent=`${h}:${m} ${ap}`;
  requestAnimationFrame(()=>setTimeout(tick,1000));
}
tick();

/* ---------- theme ---------- */
const modeToggle=$('#modeToggle'), root=document.documentElement, modeIcon=$('#modeIcon'), modeText=$('#modeText');
function applyMode(m){
  if(m==='light'){root.classList.add('light'); modeIcon.textContent='☀️'; modeText.textContent='浅色'}
  else{root.classList.remove('light'); modeIcon.textContent='🌙'; modeText.textContent='深色'}
}
applyMode(localStorage.getItem('qingdan_theme')||'dark');
modeToggle.onclick=()=>{
  const light=root.classList.toggle('light');
  localStorage.setItem('qingdan_theme', light?'light':'dark');
  applyMode(light?'light':'dark');
};

/* ---------- filter ---------- */
document.querySelectorAll('.filter-item').forEach(el=>{
  el.onclick=()=>{filter=el.dataset.filter; render();}
});

/* ---------- date/time sheet ---------- */
let pendingDate=null, pendingTime=null;
function openSheet(){
  // preload from current pills
  dateInput.value = pendingDate || isoDate(new Date());
  timeInput.value = pendingTime || '';
  sheet.classList.add('show'); sheet.setAttribute('aria-hidden','false');
}
function closeSheet(){sheet.classList.remove('show'); sheet.setAttribute('aria-hidden','true')}
datePill.onclick=openSheet; timePill.onclick=openSheet;
dtCancel.onclick=closeSheet;
dtClear.onclick=()=>{
  pendingDate = isoDate(new Date());
  pendingTime = '';
  dateInput.value = pendingDate; timeInput.value = '';
  dateLabel.textContent='今天'; timeLabel.textContent='无时间';
  closeSheet();
};
dtSave.onclick=()=>{
  pendingDate = dateInput.value || isoDate(new Date());
  pendingTime = timeInput.value || '';
  // update labels
  const todayISO=isoDate(new Date());
  dateLabel.textContent = (pendingDate===todayISO)?'今天':prettyDate(pendingDate);
  timeLabel.textContent = pendingTime?format12(pendingTime):'无时间';
  closeSheet();
};
// default labels
(function initDefault(){
  const t=new Date();
  pendingDate = isoDate(t); pendingTime='';
  dateLabel.textContent='今天'; timeLabel.textContent='无时间';
})();

/* ---------- storage helpers ---------- */
function save(){localStorage.setItem('qingdan_tasks_v4', JSON.stringify(tasks))}
function addTask(text, dueDate, dueTime){
  tasks.push({id:Date.now(), text:text.trim(), done:false, important:false, dueDate:dueDate||null, dueTime:dueTime||null});
  // order by date + time
  tasks.sort((a,b)=>{
    const ad=a.dueDate||'9999-12-31', bd=b.dueDate||'9999-12-31';
    if(ad!==bd) return ad.localeCompare(bd);
    const at=a.dueTime||'99:99', bt=b.dueTime||'99:99';
    return at.localeCompare(bt);
  });
  save(); render();
}

/* ---------- render ---------- */
function matches(t){
  if(filter==='all') return true;
  if(filter==='today'){return t.dueDate===isoDate(new Date())}
  if(filter==='important') return t.important;
  if(filter==='done') return t.done;
  if(filter==='todo') return !t.done;
  return true;
}
function updateCounts(){
  const todayISO=isoDate(new Date());
  counts.all.textContent=tasks.length;
  counts.today.textContent=tasks.filter(t=>t.dueDate===todayISO).length;
  counts.important.textContent=tasks.filter(t=>t.important).length;
  counts.done.textContent=tasks.filter(t=>t.done).length;
  counts.todo.textContent=tasks.filter(t=>!t.done).length;
}
function render(){
  listEl.innerHTML='';
  tasks.filter(matches).forEach(t=>{
    const row=document.createElement('div'); row.className='item';
    const cb=document.createElement('input'); cb.type='checkbox'; cb.checked=t.done;
    cb.onchange=()=>{t.done=cb.checked; save(); render();};
    const title=document.createElement('div'); title.className='title'; title.textContent=t.text; if(t.done) title.style.textDecoration='line-through';

    const chips=document.createElement('div'); chips.className='chips';
    if(t.dueDate){const c=document.createElement('span'); c.className='chip';
      c.innerHTML=`<svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h1V3a1 1 0 0 1 1-1Zm13 9H4v9a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-9ZM5 7a1 1 0 0 0-1 1v1h16V8a1 1 0 0 0-1-1H5Z"/></svg>
      ${prettyDate(t.dueDate)}`; chips.appendChild(c);}
    if(t.dueTime){const c=document.createElement('span'); c.className='chip';
      c.innerHTML=`<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 1 1 0 20 10 10 0 0 1 0-20Zm0 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm1 3v5.17l3.59 3.58-1.42 1.42L11 12.59V7h2Z"/></svg>
      ${format12(t.dueTime)}`; chips.appendChild(c);}

    const del=document.createElement('button'); del.className='chip danger'; del.textContent='删除';
    del.onclick=()=>{tasks=tasks.filter(x=>x.id!==t.id); save(); render();};

    row.append(cb,title,chips,del); listEl.appendChild(row);
  });
  updateCounts();
}
render();

/* ---------- adding ---------- */
function doAdd(){
  const text=taskInput.value.trim();
  if(!text) return;
  addTask(text, pendingDate||null, pendingTime||null);
  taskInput.value='';
  // keep last chosen date/time as default
}
taskInput.addEventListener('keydown',e=>{if(e.key==='Enter'){e.preventDefault(); doAdd();}});
tapEnter.addEventListener('click', doAdd);

/* ---------- bootstrap ---------- */
if(!localStorage.getItem('qingdan_boot_v4')) localStorage.setItem('qingdan_boot_v4','1');
</script>
</body>
</html>

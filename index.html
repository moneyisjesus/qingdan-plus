<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Ê∏ÖÂçïPlus ‚Äî My Day</title>

  <!-- PWA hooks (keep your filenames) -->
  <link rel="manifest" href="manifest.json" />
  <meta name="theme-color" content="#0f1221" />
  <link rel="icon" href="logo-192.png" sizes="192x192" />

  <style>
    :root{
      --bg:#0c141b;
      --panel:#121821;
      --panel-soft:#161d27;
      --border:rgba(255,255,255,.07);
      --text:#e7edf3;
      --muted:#9aa3ad;
      --accent:#6ea8fe; /* soft blue accent */
      --accent-2:#8f9fff;
      --card: rgba(18,24,33,.8);
    }
    *{ box-sizing: border-box }
    html,body{ height:100%; }
    body{
      margin:0; color:var(--text); background: radial-gradient(1200px 800px at 70% -10%, #173047 0%, #0c141b 60%) fixed, var(--bg);
      font: 15px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Noto Sans, "Helvetica Neue", Arial, "Apple Color Emoji","Segoe UI Emoji";
    }

    /* Layout */
    .wrap{
      max-width: 1100px; margin: 0 auto; padding: 36px 18px 120px;
    }
    header{
      display:flex; align-items:center; justify-content:space-between; gap:16px;
      margin-bottom: 22px;
    }
    .title h1{ font-size: 40px; margin: 0 0 4px; letter-spacing:.2px; }
    .title .date{ color:var(--muted); font-size:14px; }
    .h-actions{ display:flex; gap:8px; }
    .icon-btn{
      width:40px; height:40px; border-radius:10px; border:1px solid var(--border);
      background: var(--panel); color:var(--text); font-size:18px; cursor:pointer;
    }
    .hero{
      position:relative; margin-top:10px; margin-bottom:18px; border-radius:18px; overflow:hidden; min-height:240px;
      background: linear-gradient(180deg, rgba(0,0,0,.05) 0%, rgba(0,0,0,.35) 100%),
                  url('https://images.unsplash.com/photo-1485872299829-c673f5194813?q=80&w=1800&auto=format&fit=crop') center/cover no-repeat;
      border: 1px solid var(--border);
      box-shadow: 0 12px 40px rgba(0,0,0,.35);
      display:flex; align-items:center; justify-content:center;
    }
    .hero-card{
      width:min(560px, calc(100% - 28px));
      background: var(--card);
      border:1px solid var(--border);
      border-radius:16px; padding:26px;
      text-align:center;
      backdrop-filter: blur(6px);
    }
    .hero-card h2{ margin: 0 0 10px; font-size:26px; }
    .hero-card p{ margin: 0 0 16px; color:var(--muted); }
    .btn{
      height:40px; padding:0 16px; border-radius:10px; border:1px solid transparent; cursor:pointer;
      background: linear-gradient(180deg, var(--accent) 0%, var(--accent-2) 100%);
      color:#0f1221; font-weight:600;
      box-shadow: 0 6px 16px rgba(110,168,254,.35), inset 0 1px 0 rgba(255,255,255,.25);
    }

    /* Task list */
    .list{ margin-top: 18px; display:grid; gap:8px; }
    .task{
      display:grid; grid-template-columns: 36px 1fr auto; align-items:center; gap:10px;
      background: var(--panel); border:1px solid var(--border); border-radius:12px; padding:10px 12px;
    }
    .tick{
      width:20px; height:20px; border-radius:50%; border:2px solid var(--muted); cursor:pointer;
      display:grid; place-items:center; color:var(--panel);
    }
    .tick.done{ background: var(--accent); border-color:var(--accent); color:#0f1221; }
    .task-title{ font-size:15px; }
    .task-meta{ color:var(--muted); font-size:12px; }
    .pill{
      border:1px solid var(--border); background: var(--panel-soft);
      color:var(--muted); padding:3px 8px; border-radius:999px; margin-left:8px; font-size:12px;
    }
    .task-right{ display:flex; align-items:center; gap:6px; }
    .icon-mini{
      width:34px; height:34px; border-radius:9px; border:1px solid var(--border);
      background: var(--panel-soft); color:var(--text); font-size:15px; cursor:pointer;
    }

    /* Quick Add Bar */
    .qb{
      position: fixed; left: 50%; bottom: 18px; transform: translateX(-50%);
      width: min(940px, calc(100vw - 28px)); height: 56px;
      background: rgba(26,26,31,.92); backdrop-filter: blur(8px);
      border: 1px solid rgba(255,255,255,.06);
      border-radius: 12px; box-shadow: 0 10px 30px rgba(0,0,0,.25);
      display: grid; grid-template-columns: 56px 1fr auto; align-items: center;
      padding-inline: 8px; z-index: 50; color: #fff;
    }
    .qb-btn{
      width: 40px; height: 40px; border-radius: 10px; border: 0;
      background: #2f2f37; color: #fff; font-size: 22px; cursor: pointer;
    }
    .qb-btn:active{ transform: scale(.98); }
    .qb-input{
      width: 100%; height: 40px; margin: 0 10px; padding: 0 12px;
      border-radius: 8px; border: 1px solid rgba(255,255,255,.08);
      background: #1e1e24; color: #fff; outline: none; font-size: 16px;
    }
    .qb-input::placeholder{ color: #9aa3ad; }
    .qb-actions{ display: flex; gap: 6px; }
    .qb-icon{
      width: 40px; height: 40px; border-radius: 10px; border: 0;
      background: #2f2f37; color: #fff; font-size: 18px; cursor: pointer;
    }
    .qb-icon:active{ transform: scale(.97); }
    .qb-picker{ position: fixed; inset: 0; opacity: 0; pointer-events: none; }

    @media (max-width: 520px){
      .title h1{ font-size: 34px; }
      .hero{ min-height: 200px; }
      .qb{ grid-template-columns: 46px 1fr auto; height: 52px; }
      .qb-btn,.qb-icon{ width: 36px; height: 36px; font-size: 18px; }
      .qb-input{ height: 36px; font-size: 15px; }
    }
  </style>
</head>
<body>

  <div class="wrap">
    <header>
      <div class="title">
        <h1>My Day</h1>
        <div class="date" id="todayLabel"></div>
      </div>
      <div class="h-actions">
        <button class="icon-btn" title="Background">üñºÔ∏è</button>
        <button class="icon-btn" title="Ideas">üí°</button>
        <button class="icon-btn" title="More">‚ãØ</button>
      </div>
    </header>

    <!-- Pretty hero/empty state -->
    <section class="hero" id="hero">
      <div class="hero-card" id="heroCard">
        <h2>Focus on your day</h2>
        <p>Get things done with My Day ‚Äî a list that refreshes every day.</p>
        <button class="btn" id="focusBtn">Add task to My Day</button>
      </div>
    </section>

    <!-- Task list -->
    <section class="list" id="taskList" aria-live="polite"></section>
  </div>

  <!-- Quick Add Bar -->
  <div id="quickbar" class="qb" role="group" aria-label="Quick add">
    <button id="qb-add" class="qb-btn" aria-label="Add">Ôºã</button>
    <input id="qb-input" class="qb-input" type="text" placeholder="Add a task‚Ä¶" />
    <nav class="qb-actions" aria-label="Actions">
      <button class="qb-icon" id="qb-nav-tasks"   title="Tasks">üè†</button>
      <button class="qb-icon" id="qb-reminder"    title="Reminder">‚è∞</button>
      <button class="qb-icon" id="qb-duedate"     title="Due date">üìÖ</button>
      <button class="qb-icon" id="qb-more"        title="More">‚ãØ</button>
    </nav>
    <!-- hidden pickers (triggered by icons) -->
    <input id="qb-reminder-picker" type="datetime-local" class="qb-picker" />
    <input id="qb-duedate-picker"  type="date"           class="qb-picker" />
  </div>

  <script>
    // ===== Utilities =====
    const $ = sel => document.querySelector(sel);
    const $$ = sel => Array.from(document.querySelectorAll(sel));
    const fmtDate = ts => {
      const d = new Date(ts);
      return d.toLocaleDateString(undefined, {year:'numeric', month:'short', day:'numeric'});
    };
    const fmtToday = () => {
      const d = new Date();
      return d.toLocaleDateString(undefined, {weekday:'long', day:'numeric', month:'long'});
    }

    // ===== Storage =====
    const KEY = "qd_tasks";
    function loadTasks(){
      try { return JSON.parse(localStorage.getItem(KEY) || "[]"); }
      catch { return []; }
    }
    function saveTasks(list){ localStorage.setItem(KEY, JSON.stringify(list)); }
    function addTask(title, opts = {}){
      const items = loadTasks();
      items.push({
        id: crypto.randomUUID(),
        title: title.trim(),
        createdAt: Date.now(),
        list: opts.list ?? "myday",
        done: false,
        due: opts.due ?? null,
        reminder: opts.reminder ?? null
      });
      saveTasks(items);
      render();
    }
    function setTask(id, patch){
      const items = loadTasks();
      const i = items.findIndex(t => t.id === id);
      if (i !== -1){ items[i] = { ...items[i], ...patch }; saveTasks(items); }
      render();
    }
    function clearOldMyDay(){
      // Optional rotation: keep My Day tasks but you could clear done ones here
    }

    // ===== Rendering =====
    function render(){
      const list = $("#taskList");
      const tasks = loadTasks().filter(t => t.list === "myday");
      list.innerHTML = "";

      if (tasks.length === 0){
        $("#hero").style.display = "";
      } else {
        $("#hero").style.display = "block";
        $("#heroCard").style.display = "none";
      }

      for (const t of tasks.sort((a,b)=> (a.done-b.done) || ((a.due||Infinity)-(b.due||Infinity)) )){
        const row = document.createElement("article");
        row.className = "task";
        row.innerHTML = `
          <button class="tick ${t.done ? "done":""}" aria-label="Toggle complete">${t.done ? "‚úì" : ""}</button>
          <div>
            <div class="task-title">${escapeHtml(t.title)}</div>
            <div class="task-meta">
              ${t.due ? `<span class="pill">Due ${fmtDate(t.due)}</span>` : ""}
              ${t.reminder ? `<span class="pill">üîî ${new Date(t.reminder).toLocaleString()}</span>` : ""}
            </div>
          </div>
          <div class="task-right">
            <button class="icon-mini" title="Reminder">‚è∞</button>
            <button class="icon-mini" title="Due date">üìÖ</button>
            <button class="icon-mini" title="Delete">üóëÔ∏è</button>
          </div>
        `;
        // Tick
        row.querySelector(".tick").addEventListener("click", ()=> setTask(t.id, {done: !t.done}));
        // Reminder
        row.querySelectorAll(".icon-mini")[0].addEventListener("click", ()=>{
          const val = prompt("Set reminder (YYYY-MM-DD hh:mm)", "");
          if (!val) return;
          const iso = toISO(val);
          if (iso) setTask(t.id, {reminder: iso});
        });
        // Due date
        row.querySelectorAll(".icon-mini")[1].addEventListener("click", ()=>{
          const val = prompt("Set due date (YYYY-MM-DD)", "");
          if (!val) return;
          const iso = toISO(val + " 23:59");
          if (iso) setTask(t.id, {due: new Date(iso).setHours(23,59,0,0)});
        });
        // Delete
        row.querySelectorAll(".icon-mini")[2].addEventListener("click", ()=>{
          const items = loadTasks().filter(x => x.id !== t.id);
          saveTasks(items); render();
        });

        list.appendChild(row);
      }
    }

    function escapeHtml(s){
      return s.replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
    }
    function toISO(val){
      // very lenient parser: "YYYY-MM-DD hh:mm" or "YYYY-MM-DD"
      const d = new Date(val.replace(" ", "T"));
      return isNaN(d) ? null : d.toISOString();
    }

    // ===== Quick Add Bar =====
    (function initQuickBar(){
      $("#todayLabel").textContent = fmtToday();
      clearOldMyDay();
      render();

      const input = $('#qb-input');
      const addBtn = $('#qb-add');
      const navTasks = $('#qb-nav-tasks');
      const remindBtn = $('#qb-reminder');
      const dueBtn = $('#qb-duedate');
      const moreBtn = $('#qb-more');
      const reminderPick = $('#qb-reminder-picker');
      const duePick = $('#qb-duedate-picker');
      const focusBtn = $('#focusBtn');

      let pending = { reminder:null, due:null };

      function submit(){
        const text = input.value.trim();
        if (!text) return;
        addTask(text, pending);
        input.value = "";
        pending = { reminder:null, due:null };
        $('#heroCard').style.display = "none";
      }

      addBtn.addEventListener('click', submit);
      input.addEventListener('keydown', (e)=>{ if(e.key==='Enter') submit(); });
      focusBtn.addEventListener('click', () => input.focus());

      // ‚Äúüè† Tasks‚Äù icon: scroll to top (or hook to your router)
      navTasks.addEventListener('click', ()=> window.scrollTo({top:0, behavior:'smooth'}));

      // ‚è∞ reminder
      remindBtn.addEventListener('click', () => { reminderPick.value = ""; reminderPick.click(); });
      reminderPick.addEventListener('change', () => {
        if (reminderPick.value) pending.reminder = new Date(reminderPick.value).toISOString();
      });

      // üìÖ due date
      dueBtn.addEventListener('click', () => { duePick.value = ""; duePick.click(); });
      duePick.addEventListener('change', () => {
        if (duePick.value) pending.due = new Date(duePick.value + "T23:59:00").getTime();
      });

      // ‚ãØ more (labels/lists/priority later)
      moreBtn.addEventListener('click', () => {
        alert('More options coming soon: priority, pick list, notes‚Ä¶');
      });
    })();

    // ===== Service Worker =====
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./service-worker.js').catch(()=>{});
      });
    }
  </script>
</body>
</html>

<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>æ¸…å•Plus</title>
<meta name="theme-color" content="#0f1221" />
<link rel="manifest" href="manifest.json" />

<style>
  :root{
    --bg:#0f1221;
    --panel:#14182b;
    --panel-2:#101426;
    --text:#e9ecf5;
    --muted:#9aa3b2;
    --brand:#7c8cff;
    --accent:#95e1ff;
    --chip:#1b2140;
    --ok:#40d589;
    --danger:#ff6b6b;
    --shadow:0 10px 25px rgba(0,0,0,.35);
    --radius:16px;
  }
  :root.light{
    --bg:#f6f7fb;
    --panel:#ffffff;
    --panel-2:#ffffff;
    --text:#111423;
    --muted:#606a78;
    --brand:#5b6cff;
    --accent:#007aff;
    --chip:#eef1ff;
    --ok:#10b981;
    --danger:#ef4444;
    --shadow:0 10px 25px rgba(0,0,0,.08);
  }

  *{box-sizing:border-box}
  html,body{height:100%}
  body{
    margin:0; background:var(--bg); color:var(--text);
    font:500 16px/1.45 ui-sans-serif,system-ui,-apple-system,"SF Pro Text","Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Noto Sans CJK SC","Microsoft YaHei",sans-serif;
  }

  .wrap{max-width:980px;margin:0 auto;padding:18px 14px 26px}

  /* header */
  .top{
    display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center; margin:6px 0 14px;
  }
  .brand{
    display:flex; align-items:center; gap:12px;
  }
  .logo-dot{
    width:36px; height:36px; border-radius:12px;
    background:linear-gradient(135deg, #7c8cff 0%, #a677ff 100%);
    box-shadow:var(--shadow);
  }
  .brand h1{
    margin:0; font-size:20px; letter-spacing:.5px;
  }
  .meta{
    text-align:right; display:flex; flex-direction:column; gap:2px; align-items:flex-end;
  }
  .meta .date{font-weight:700; font-size:13px; color:var(--muted)}
  .meta .time{font-weight:800; font-size:22px}
  .toggle{
    margin-top:4px;
    display:inline-flex; align-items:center; gap:8px; padding:6px 10px; border-radius:999px;
    background:var(--panel); box-shadow:var(--shadow); color:var(--muted); cursor:pointer; user-select:none;
  }

  /* panels */
  .panel{
    background:var(--panel); border-radius:var(--radius); box-shadow:var(--shadow);
  }

  /* filters */
  .filters{padding:12px}
  .filter-item{
    display:flex; justify-content:space-between; align-items:center;
    padding:14px 12px; border-radius:12px; margin:6px 0; background:var(--panel-2);
  }
  .filter-item b{font-weight:700}
  .badge{
    min-width:28px; text-align:center; padding:3px 8px; border-radius:999px; background:var(--chip); color:var(--muted);
  }

  /* list */
  .list{margin-top:14px}
  .item{
    display:flex; align-items:center; gap:10px; padding:14px; border-radius:14px;
    background:var(--panel); box-shadow:var(--shadow); margin:10px 0;
  }
  .item input[type="checkbox"]{width:22px; height:22px; accent-color:var(--ok)}
  .title{flex:1; font-weight:700}
  .chips{display:flex; gap:8px; flex-wrap:wrap}
  .chip{
    display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:999px; background:var(--chip); color:var(--muted); font-size:13px;
  }
  .chip svg{width:15px;height:15px;opacity:.9}
  .danger{color:#fff;background:linear-gradient(135deg, #ff7a7a, #ff4d4d)}

  /* composer */
  .composer{
    margin-top:16px; padding:14px; border-radius:var(--radius); background:var(--panel); box-shadow:var(--shadow);
  }
  .row{display:flex; gap:10px; align-items:center}
  .input{
    flex:1; min-height:48px; padding:12px 14px; border:2px solid transparent; outline:0;
    border-radius:12px; background:var(--panel-2); color:var(--text); font-size:16px;
  }
  .input:focus{border-color:var(--brand)}
  .pickers{display:flex; gap:10px}
  .pill{
    display:inline-flex; align-items:center; gap:8px; padding:10px 12px; border-radius:999px;
    background:var(--chip); color:var(--text); cursor:pointer; user-select:none;
  }
  .pill svg{width:18px;height:18px}
  .hint{margin-top:10px; color:var(--muted); font-size:13px}

  /* footer */
  footer{margin:24px 0 8px; text-align:center; color:var(--muted); font-size:12px}

  /* mobile first */
  @media (min-width:760px){
    .top{grid-template-columns:1fr auto}
  }
</style>
</head>
<body>

<div class="wrap">
  <!-- header -->
  <div class="top">
    <div class="brand">
      <div class="logo-dot"></div>
      <h1>æ¸…å•Plus</h1>
    </div>
    <div class="meta">
      <div class="date" id="todayStr">2025-09-06</div>
      <div class="time" id="nowStr">4:50 PM</div>
      <div class="toggle" id="modeToggle" title="åˆ‡æ¢æ·±æµ…è‰²">
        <span id="modeIcon">ğŸŒ™</span><span id="modeText">æ·±è‰²</span>
      </div>
    </div>
  </div>

  <!-- left filters (kept minimal like you asked) -->
  <div class="panel filters" id="filters">
    <div class="filter-item" data-filter="all"><span>å…¨éƒ¨</span><span class="badge" id="count-all">0</span></div>
    <div class="filter-item" data-filter="today"><span>ä»Šå¤©</span><span class="badge" id="count-today">0</span></div>
    <div class="filter-item" data-filter="important"><span><b>é‡è¦</b></span><span class="badge" id="count-important">0</span></div>
    <div class="filter-item" data-filter="done"><span>å·²å®Œæˆ</span><span class="badge" id="count-done">0</span></div>
    <div class="filter-item" data-filter="todo"><span>æœªå®Œæˆ</span><span class="badge" id="count-todo">0</span></div>
  </div>

  <!-- list -->
  <div id="list" class="list"></div>

  <!-- composer -->
  <div class="composer">
    <div class="row">
      <input id="taskInput" class="input" type="text" placeholder="è¾“å…¥ä»»åŠ¡â€¦" autocomplete="off" />
      <div class="pickers">
        <div class="pill" id="datePill" role="button" aria-label="é€‰æ‹©æ—¥æœŸ">
          <!-- calendar icon -->
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h1V3a1 1 0 0 1 1-1Zm13 9H4v9a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-9ZM5 7a1 1 0 0 0-1 1v1h16V8a1 1 0 0 0-1-1H5Z"/></svg>
          <span id="dateLabel">ä»Šå¤©</span>
        </div>
        <div class="pill" id="timePill" role="button" aria-label="é€‰æ‹©æ—¶é—´">
          <!-- clock icon -->
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 1 1 0 20 10 10 0 0 1 0-20Zm0 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm1 3v5.17l3.59 3.58-1.42 1.42L11 12.59V7h2Z"/></svg>
          <span id="timeLabel">æ— æ—¶é—´</span>
        </div>
      </div>
    </div>
    <div class="hint">æç¤ºï¼šè¾“å…¥åå¯æŒ‰ <b>Enter</b> ç›´æ¥æ·»åŠ ï¼›ç‚¹ã€ŒğŸ“… â°ã€è®¾ç½®æ—¥æœŸä¸æ—¶é—´</div>
    <!-- hidden real inputs triggered by the pills for best iOS/Android keyboards -->
    <input id="dateInput" type="date" hidden />
    <input id="timeInput" type="time" hidden />
  </div>

  <footer>Â© 2025 æ¸…å•Plus Â· æœ¬åœ°ä¿å­˜ Â· è½»å¿« Â· æç®€</footer>
</div>

<script>
/* ========== UTIL ========== */
const $ = sel => document.querySelector(sel);
const listEl = $('#list');
const taskInput = $('#taskInput');
const datePill = $('#datePill');
const timePill = $('#timePill');
const dateInput = $('#dateInput');
const timeInput = $('#timeInput');
const dateLabel = $('#dateLabel');
const timeLabel = $('#timeLabel');

const todayStrEl = $('#todayStr');
const nowStrEl = $('#nowStr');

const counts = {
  all: $('#count-all'),
  today: $('#count-today'),
  important: $('#count-important'),
  done: $('#count-done'),
  todo: $('#count-todo')
};

let filter = 'all';
let tasks = JSON.parse(localStorage.getItem('qingdan_tasks_v3')||'[]');

/* ========== TIME DISPLAY (12h) ========== */
function pad(n){return n<10?'0'+n:n}
function format12(date){
  let h = date.getHours(), m = date.getMinutes();
  const ampm = h>=12?'PM':'AM';
  h = h%12; if(h===0) h=12;
  return `${h}:${pad(m)} ${ampm}`;
}
function formatDateISO(d){ // yyyy-mm-dd
  const y=d.getFullYear(), m=pad(d.getMonth()+1), dd=pad(d.getDate());
  return `${y}-${m}-${dd}`;
}
function formatPretty(dateStr){ // e.g. Sep 6, 2025
  try{
    const d = new Date(dateStr+'T00:00:00');
    return d.toLocaleDateString(undefined,{month:'short',day:'numeric',year:'numeric'});
  }catch{ return dateStr }
}
function tick(){
  const now=new Date();
  todayStrEl.textContent = formatDateISO(now);
  nowStrEl.textContent = format12(now);
  requestAnimationFrame(()=>setTimeout(tick,1000));
}
tick();

/* ========== THEME ========== */
const root = document.documentElement;
const modeToggle = $('#modeToggle');
const modeIcon = $('#modeIcon');
const modeText = $('#modeText');
function applyMode(m){
  if(m==='light'){root.classList.add('light'); modeIcon.textContent='â˜€ï¸'; modeText.textContent='æµ…è‰²'}
  else{root.classList.remove('light'); modeIcon.textContent='ğŸŒ™'; modeText.textContent='æ·±è‰²'}
}
applyMode(localStorage.getItem('qingdan_theme')||'dark');
modeToggle.addEventListener('click',()=>{
  const isLight = root.classList.toggle('light');
  localStorage.setItem('qingdan_theme', isLight?'light':'dark');
  applyMode(isLight?'light':'dark');
});

/* ========== FILTERS ========== */
document.querySelectorAll('.filter-item').forEach(el=>{
  el.addEventListener('click',()=>{
    filter = el.dataset.filter;
    render();
  });
});

/* ========== DATE/TIME PILLS (OPEN NATIVE PICKERS) ========== */
function resetPickersToDefault(){
  // default: date = today, time = empty
  const t = new Date();
  dateInput.value = formatDateISO(t);
  dateLabel.textContent = 'ä»Šå¤©';
  timeInput.value = '';
  timeLabel.textContent = 'æ— æ—¶é—´';
}
resetPickersToDefault();

datePill.addEventListener('click',()=>dateInput.showPicker?.() ?? dateInput.click());
timePill.addEventListener('click',()=>timeInput.showPicker?.() ?? timeInput.click());

dateInput.addEventListener('change',()=>{
  const todayISO = formatDateISO(new Date());
  dateLabel.textContent = (dateInput.value===todayISO)?'ä»Šå¤©':formatPretty(dateInput.value);
});
timeInput.addEventListener('change',()=>{
  if(!timeInput.value){ timeLabel.textContent='æ— æ—¶é—´'; return; }
  // convert "HH:MM" to 12h
  const [H,M]=timeInput.value.split(':').map(v=>parseInt(v,10));
  let h=H%12; if(h===0) h=12;
  timeLabel.textContent = `${h}:${M.toString().padStart(2,'0')} ${H>=12?'PM':'AM'}`;
});

/* ========== STORAGE HELPERS ========== */
function save(){localStorage.setItem('qingdan_tasks_v3', JSON.stringify(tasks))}
function addTask(text, dueDate, dueTime){
  tasks.push({
    id: Date.now(),
    text: text.trim(),
    done:false,
    important:false,
    dueDate: dueDate || null,   // 'yyyy-mm-dd'
    dueTime: dueTime || null    // 'HH:MM'
  });
  // sort by date/time if present
  tasks.sort((a,b)=>{
    const ad = a.dueDate? a.dueDate : '9999-12-31';
    const bd = b.dueDate? b.dueDate : '9999-12-31';
    if(ad!==bd) return ad.localeCompare(bd);
    const at = a.dueTime? a.dueTime : '99:99';
    const bt = b.dueTime? b.dueTime : '99:99';
    return at.localeCompare(bt);
  });
  save(); render();
}

/* ========== RENDER ========== */
function matchFilter(t){
  if(filter==='all') return true;
  if(filter==='today'){
    const todayISO=formatDateISO(new Date());
    return t.dueDate===todayISO;
  }
  if(filter==='important') return t.important;
  if(filter==='done') return t.done;
  if(filter==='todo') return !t.done;
  return true;
}
function updateCounts(){
  counts.all.textContent = tasks.length;
  const todayISO = formatDateISO(new Date());
  counts.today.textContent = tasks.filter(t=>t.dueDate===todayISO).length;
  counts.important.textContent = tasks.filter(t=>t.important).length;
  counts.done.textContent = tasks.filter(t=>t.done).length;
  counts.todo.textContent = tasks.filter(t=>!t.done).length;
}
function render(){
  listEl.innerHTML='';
  tasks.filter(matchFilter).forEach(t=>{
    const li=document.createElement('div');
    li.className='item';

    const cb=document.createElement('input');
    cb.type='checkbox';
    cb.checked=t.done;
    cb.addEventListener('change',()=>{t.done=cb.checked; save(); render();});

    const title=document.createElement('div');
    title.className='title';
    title.textContent=t.text;
    if(t.done) title.style.textDecoration='line-through';

    const chips=document.createElement('div');
    chips.className='chips';

    if(t.dueDate){
      const c=document.createElement('span');
      c.className='chip';
      c.innerHTML=`<svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h1V3a1 1 0 0 1 1-1Zm13 9H4v9a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-9ZM5 7a1 1 0 0 0-1 1v1h16V8a1 1 0 0 0-1-1H5Z"/></svg>
      ${formatPretty(t.dueDate)}`;
      chips.appendChild(c);
    }
    if(t.dueTime){
      const c=document.createElement('span');
      c.className='chip';
      const [H,M]=t.dueTime.split(':').map(v=>parseInt(v,10));
      let h=H%12; if(h===0) h=12;
      c.innerHTML=`<svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 1 1 0 20 10 10 0 0 1 0-20Zm0 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm1 3v5.17l3.59 3.58-1.42 1.42L11 12.59V7h2Z"/></svg>
      ${h}:${M.toString().padStart(2,'0')} ${H>=12?'PM':'AM'}`;
      chips.appendChild(c);
    }

    const del=document.createElement('button');
    del.className='chip danger';
    del.textContent='åˆ é™¤';
    del.addEventListener('click',()=>{tasks=tasks.filter(x=>x.id!==t.id); save(); render();});

    li.append(cb,title,chips,del);
    listEl.appendChild(li);
  });
  updateCounts();
}
render();

/* ========== ADD BY ENTER ========== */
taskInput.addEventListener('keydown',(e)=>{
  if(e.key==='Enter'){
    e.preventDefault();
    const text=taskInput.value.trim();
    if(!text) return;
    addTask(text, dateInput.value||null, timeInput.value||null);
    taskInput.value='';
    resetPickersToDefault();
  }
});

/* ========== FIRST TIME HELP (optional) ========== */
if(!localStorage.getItem('qingdan_boot')){
  localStorage.setItem('qingdan_boot','1');
}
</script>
</body>
</html>

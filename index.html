<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>清单Plus</title>
<meta name="theme-color" content="#0f1221" />
<style>
  :root{
    --bg:#0f1221; --panel:#14182b; --panel-2:#101426; --text:#e9ecf5; --muted:#9aa3b2;
    --brand:#7c8cff; --accent:#95e1ff; --chip:#1b2140; --ok:#40d589; --danger:#ff6b6b;
    --shadow:0 10px 25px rgba(0,0,0,.35); --radius:16px;
  }
  :root.light{
    --bg:#f6f7fb; --panel:#fff; --panel-2:#fff; --text:#111423; --muted:#606a78;
    --brand:#5b6cff; --accent:#007aff; --chip:#eef1ff; --ok:#10b981; --danger:#ef4444;
    --shadow:0 10px 25px rgba(0,0,0,.08);
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);
    font:500 16px/1.45 ui-sans-serif,system-ui,-apple-system,"SF Pro Text","Segoe UI",Roboto,Helvetica,Arial,"PingFang SC","Noto Sans CJK SC","Microsoft YaHei",sans-serif;}
  .wrap{max-width:980px;margin:0 auto;padding:18px 14px 26px}

  .top{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;margin:6px 0 14px}
  .brand{display:flex;align-items:center;gap:12px}
  .logo-dot{width:36px;height:36px;border-radius:12px;background:linear-gradient(135deg,#7c8cff 0%,#a677ff 100%);box-shadow:var(--shadow)}
  .brand h1{margin:0;font-size:20px;letter-spacing:.5px}
  .meta{text-align:right;display:flex;flex-direction:column;gap:2px;align-items:flex-end}
  .meta .date{font-weight:700;font-size:13px;color:var(--muted)}
  .meta .time{font-weight:800;font-size:22px}
  .toggle{margin-top:4px;display:inline-flex;align-items:center;gap:8px;padding:6px 10px;border-radius:999px;background:var(--panel);box-shadow:var(--shadow);color:var(--muted);cursor:pointer;user-select:none}

  .panel{background:var(--panel);border-radius:var(--radius);box-shadow:var(--shadow)}
  .filters{padding:12px}
  .filter-item{display:flex;justify-content:space-between;align-items:center;padding:14px 12px;border-radius:12px;margin:6px 0;background:var(--panel-2);cursor:pointer}
  .filter-item b{font-weight:700}
  .badge{min-width:28px;text-align:center;padding:3px 8px;border-radius:999px;background:var(--chip);color:var(--muted)}

  .list{margin-top:14px}
  .item{display:flex;align-items:center;gap:10px;padding:14px;border-radius:14px;background:var(--panel);box-shadow:var(--shadow);margin:10px 0}
  .item input[type="checkbox"]{width:22px;height:22px;accent-color:var(--ok)}
  .title{flex:1;font-weight:700}
  .chips{display:flex;gap:8px;flex-wrap:wrap}
  .chip{display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:999px;background:var(--chip);color:var(--muted);font-size:13px}
  .chip svg{width:15px;height:15px;opacity:.9}
  .danger{color:#fff;background:linear-gradient(135deg,#ff7a7a,#ff4d4d)}
  .btn{border:0;border-radius:12px;padding:10px 14px;background:var(--brand);color:#fff;font-weight:700;cursor:pointer}
  .ghost{background:var(--chip);color:var(--text)}

  .composer{margin-top:16px;padding:14px;border-radius:var(--radius);background:var(--panel);box-shadow:var(--shadow)}
  .row{display:flex;gap:10px;align-items:center}
  .input-wrap{position:relative;flex:1}
  .input{width:100%;min-height:52px;padding:12px 14px;border:2px solid transparent;outline:0;border-radius:12px;background:var(--panel-2);color:var(--text);font-size:17px;padding-right:88px}
  .input:focus{border-color:var(--brand)}
  .enter-inline{position:absolute;right:8px;top:50%;transform:translateY(-50%);display:none;align-items:center;gap:6px;border:0;border-radius:10px;background:var(--ok);color:#fff;padding:8px 10px;font-weight:800}
  .input-wrap.has-text .enter-inline{display:inline-flex}

  .pickers{display:flex;gap:10px}
  .pill{display:inline-flex;align-items:center;gap:8px;padding:10px 12px;border-radius:999px;background:var(--chip);color:var(--text);cursor:pointer;user-select:none}
  .pill svg{width:18px;height:18px}

  .hint{margin-top:10px;color:var(--muted);font-size:13px}

  /* quick panel (inline) */
  .quick{display:none;margin-top:12px;padding:12px;border-radius:12px;background:var(--panel-2)}
  .quick.show{display:block}
  .quick .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .quick input{width:100%;border:2px solid transparent;background:var(--panel);color:var(--text);padding:11px;border-radius:12px;font-size:16px}
  .quick .row2{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
  .seg{padding:8px 12px;border-radius:999px;background:var(--chip);cursor:pointer;color:var(--muted);user-select:none}
  .seg.active{background:linear-gradient(135deg,#7c8cff,#a677ff);color:#fff;font-weight:800}
  .quick .foot{display:flex;gap:8px;justify-content:flex-end;margin-top:10px}

  .summary{margin-top:10px;color:var(--muted);font-size:14px}
  .summary b{color:var(--text)}
  footer{margin:24px 0 8px;text-align:center;color:var(--muted);font-size:12px}
</style>
</head>
<body>
<div class="wrap">
  <div class="top">
    <div class="brand">
      <div class="logo-dot"></div><h1>清单Plus</h1>
    </div>
    <div class="meta">
      <div class="date" id="todayStr">2025-09-06</div>
      <div class="time" id="nowStr">4:50 PM</div>
      <div class="toggle" id="modeToggle"><span id="modeIcon">🌙</span><span id="modeText">深色</span></div>
    </div>
  </div>

  <div class="panel filters">
    <div class="filter-item" data-filter="all"><span>全部</span><span class="badge" id="count-all">0</span></div>
    <div class="filter-item" data-filter="today"><span>今天</span><span class="badge" id="count-today">0</span></div>
    <div class="filter-item" data-filter="important"><span><b>重要</b></span><span class="badge" id="count-important">0</span></div>
    <div class="filter-item" data-filter="done"><span>已完成</span><span class="badge" id="count-done">0</span></div>
    <div class="filter-item" data-filter="todo"><span>未完成</span><span class="badge" id="count-todo">0</span></div>
  </div>

  <div id="list" class="list"></div>

  <!-- Composer -->
  <div class="composer">
    <div class="row">
      <div class="input-wrap" id="inputWrap">
        <input id="taskInput" class="input" placeholder="输入任务…" autocomplete="off" />
        <button id="enterInline" class="enter-inline" aria-label="添加任务">
          <svg viewBox="0 0 24 24" fill="currentColor" width="18" height="18"><path d="M19 11H7.83l4.58-4.59L11 5l-7 7 7 7 1.41-1.41L7.83 13H19z"/></svg>
          Enter
        </button>
      </div>
      <div class="pickers">
        <div class="pill" id="datePill" role="button" aria-label="选择日期">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h1V3a1 1 0 0 1 1-1Zm13 9H4v9a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-9ZM5 7a1 1 0 0 0-1 1v1h16V8a1 1 0 0 0-1-1H5Z"/></svg>
          <span id="dateLabel">今天</span>
        </div>
        <div class="pill" id="timePill" role="button" aria-label="选择时间">
          <svg viewBox="0 0 24 24" fill="currentColor"><path d="M12 2a10 10 0 1 1 0 20 10 10 0 0 1 0-20Zm0 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm1 3v5.17l3.59 3.58-1.42 1.42L11 12.59V7h2Z"/></svg>
          <span id="timeLabel">无时间</span>
        </div>
      </div>
    </div>

    <!-- summary below input -->
    <div class="summary">提醒：<b id="repeatSummary">不重复</b></div>

    <!-- inline quick panel (date/time + repeat) -->
    <div class="quick" id="quickPanel">
      <div class="grid">
        <input id="dateInput" type="date" />
        <input id="timeInput" type="time" />
      </div>
      <div class="row2" id="repeatSeg">
        <div class="seg active" data-repeat="none">不重复</div>
        <div class="seg" data-repeat="daily">每日</div>
        <div class="seg" data-repeat="weekly">每周</div>
        <div class="seg" data-repeat="monthly">每月</div>
        <div class="seg" data-repeat="yearly">每年</div>
        <div class="seg" data-repeat="custom">自定义</div>
      </div>
      <div class="foot">
        <button class="btn ghost" id="quickClose">关闭</button>
        <button class="btn" id="quickApply">应用</button>
      </div>
    </div>

    <div class="hint">提示：输入后右侧会出现 <b>Enter</b> 按钮添加；点击「📅 ⏰」立即展开日期与时间；下方可选择“重复”方式</div>
  </div>

  <footer>© 2025 清单Plus · 本地保存 · 轻快 · 极简</footer>
</div>

<script>
/* ---------- helpers ---------- */
const $ = s=>document.querySelector(s);
const listEl = $('#list');
const taskInput = $('#taskInput');
const inputWrap = $('#inputWrap');
const enterInline = $('#enterInline');

const todayStrEl = $('#todayStr');
const nowStrEl   = $('#nowStr');

const datePill = $('#datePill'), timePill = $('#timePill');
const dateLabel = $('#dateLabel'), timeLabel = $('#timeLabel');

const quick = $('#quickPanel'), dateInput = $('#dateInput'), timeInput = $('#timeInput');
const quickClose = $('#quickClose'), quickApply = $('#quickApply');

const repeatSeg = $('#repeatSeg'), repeatSummary = $('#repeatSummary');

const counts = {
  all: $('#count-all'), today: $('#count-today'), important: $('#count-important'),
  done: $('#count-done'), todo: $('#count-todo')
};
let filter='all';
let tasks = JSON.parse(localStorage.getItem('qingdan_tasks_v5')||'[]');

/* utils */
function pad(n){return n<10?'0'+n:n}
function format12(hm){ if(!hm) return ''; const [H,M]=hm.split(':').map(x=>parseInt(x,10)); let h=H%12; if(h===0) h=12; return `${h}:${pad(M)} ${H>=12?'PM':'AM'}`; }
function isoDate(d){return `${d.getFullYear()}-${pad(d.getMonth()+1)}-${pad(d.getDate())}`}
function prettyDate(iso){const d=new Date(iso+'T00:00:00'); return d.toLocaleDateString(undefined,{month:'short',day:'numeric',year:'numeric'})}
function tick(){const now=new Date(); todayStrEl.textContent=isoDate(now); let h=now.getHours(), m=pad(now.getMinutes()); const ap=h>=12?'PM':'AM'; h=h%12; if(h===0)h=12; nowStrEl.textContent=`${h}:${m} ${ap}`; requestAnimationFrame(()=>setTimeout(tick,1000));}
tick();

/* theme */
const modeToggle=$('#modeToggle'), root=document.documentElement, modeIcon=$('#modeIcon'), modeText=$('#modeText');
function applyMode(m){ if(m==='light'){root.classList.add('light'); modeIcon.textContent='☀️'; modeText.textContent='浅色'} else {root.classList.remove('light'); modeIcon.textContent='🌙'; modeText.textContent='深色'} }
applyMode(localStorage.getItem('qingdan_theme')||'dark');
modeToggle.onclick=()=>{const light=root.classList.toggle('light'); localStorage.setItem('qingdan_theme', light?'light':'dark'); applyMode(light?'light':'dark');};

/* filter */
document.querySelectorAll('.filter-item').forEach(el=>{ el.onclick=()=>{filter=el.dataset.filter; render();}; });

/* selection state (pending) */
let pendingDate = isoDate(new Date());
let pendingTime = '';
let pendingRepeat = 'none';

/* chips labels */
function repeatLabel(rep){
  return ({none:'不重复',daily:'每日',weekly:'每周',monthly:'每月',yearly:'每年',custom:'自定义'})[rep]||'不重复';
}

/* open inline quick panel with prefilled values */
function toggleQuick(show){
  if(show===undefined) quick.classList.toggle('show');
  else quick.classList.toggle('show', show);
  dateInput.value = pendingDate;
  timeInput.value = pendingTime;
  // highlight current repeat
  repeatSeg.querySelectorAll('.seg').forEach(s=>{
    s.classList.toggle('active', s.dataset.repeat===pendingRepeat);
  });
}

datePill.onclick=()=>toggleQuick(true);
timePill.onclick=()=>toggleQuick(true);
quickClose.onclick=()=>toggleQuick(false);
quickApply.onclick=()=>{
  pendingDate = dateInput.value || isoDate(new Date());
  pendingTime = timeInput.value || '';
  dateLabel.textContent = (pendingDate===isoDate(new Date()))?'今天':prettyDate(pendingDate);
  timeLabel.textContent = pendingTime?format12(pendingTime):'无时间';
  repeatSummary.textContent = repeatLabel(pendingRepeat);
  toggleQuick(false);
};

// clicking a repeat pill
repeatSeg.addEventListener('click', (e)=>{
  const el=e.target.closest('.seg'); if(!el) return;
  pendingRepeat = el.dataset.repeat;
  repeatSeg.querySelectorAll('.seg').forEach(s=>s.classList.toggle('active', s===el));
  repeatSummary.textContent = repeatLabel(pendingRepeat);
});

/* storage */
function save(){localStorage.setItem('qingdan_tasks_v5', JSON.stringify(tasks))}
function addTask(text, dueDate, dueTime, repeat){
  tasks.push({id:Date.now(), text:text.trim(), done:false, important:false, dueDate:dueDate||null, dueTime:dueTime||null, repeat:repeat||'none'});
  // sort by date then time
  tasks.sort((a,b)=>{const ad=a.dueDate||'9999-12-31', bd=b.dueDate||'9999-12-31'; if(ad!==bd) return ad.localeCompare(bd); const at=a.dueTime||'99:99', bt=b.dueTime||'99:99'; return at.localeCompare(bt);});
  save(); render();
}

/* render */
function matches(t){ if(filter==='all') return true; if(filter==='today'){return t.dueDate===isoDate(new Date())} if(filter==='important') return t.important; if(filter==='done') return t.done; if(filter==='todo') return !t.done; return true; }
function updateCounts(){ const todayISO=isoDate(new Date()); counts.all.textContent=tasks.length; counts.today.textContent=tasks.filter(t=>t.dueDate===todayISO).length; counts.important.textContent=tasks.filter(t=>t.important).length; counts.done.textContent=tasks.filter(t=>t.done).length; counts.todo.textContent=tasks.filter(t=>!t.done).length; }
function render(){
  listEl.innerHTML='';
  tasks.filter(matches).forEach(t=>{
    const row=document.createElement('div'); row.className='item';
    const cb=document.createElement('input'); cb.type='checkbox'; cb.checked=t.done;
    cb.onchange=()=>{t.done=cb.checked; save(); render();};
    const title=document.createElement('div'); title.className='title'; title.textContent=t.text; if(t.done) title.style.textDecoration='line-through';
    const chips=document.createElement('div'); chips.className='chips';

    if(t.dueDate){const c=document.createElement('span'); c.className='chip';
      c.innerHTML=`<svg viewBox="0 0 24 24" fill="currentColor" width="15" height="15"><path d="M7 2a1 1 0 0 1 1 1v1h8V3a1 1 0 1 1 2 0v1h1a3 3 0 0 1 3 3v12a3 3 0 0 1-3 3H5a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3h1V3a1 1 0 0 1 1-1Zm13 9H4v9a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-9ZM5 7a1 1 0 0 0-1 1v1h16V8a1 1 0 0 0-1-1H5Z"/></svg>
      ${prettyDate(t.dueDate)}`; chips.appendChild(c);}
    if(t.dueTime){const c=document.createElement('span'); c.className='chip';
      c.innerHTML=`<svg viewBox="0 0 24 24" fill="currentColor" width="15" height="15"><path d="M12 2a10 10 0 1 1 0 20 10 10 0 0 1 0-20Zm0 2a8 8 0 1 0 0 16 8 8 0 0 0 0-16Zm1 3v5.17l3.59 3.58-1.42 1.42L11 12.59V7h2Z"/></svg>
      ${format12(t.dueTime)}`; chips.appendChild(c);}
    if(t.repeat && t.repeat!=='none'){const c=document.createElement('span'); c.className='chip'; c.textContent=repeatLabel(t.repeat); chips.appendChild(c);}

    const del=document.createElement('button'); del.className='chip danger'; del.textContent='删除';
    del.onclick=()=>{tasks=tasks.filter(x=>x.id!==t.id); save(); render();};

    row.append(cb,title,chips,del); listEl.appendChild(row);
  });
  updateCounts();
}
render();

/* adding */
function doAdd(){
  const text=taskInput.value.trim();
  if(!text) return;
  addTask(text, pendingDate||null, pendingTime||null, pendingRepeat||'none');
  taskInput.value='';
  inputWrap.classList.remove('has-text');
}
taskInput.addEventListener('keydown',e=>{if(e.key==='Enter'){e.preventDefault(); doAdd();}});
enterInline.addEventListener('click', doAdd);
taskInput.addEventListener('input', ()=>{ if(taskInput.value.trim()) inputWrap.classList.add('has-text'); else inputWrap.classList.remove('has-text'); });

/* counts bootstrap */
if(!localStorage.getItem('qingdan_boot_v5')) localStorage.setItem('qingdan_boot_v5','1');
</script>
</body>
</html>
